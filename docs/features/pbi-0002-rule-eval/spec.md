# Requirement

- [ ] Purpose / value: ルール評価を拡張し、親子追従・外部フォールバック・優先度・変数展開で実運用の精度を高める。
- [ ] Scope:
  - 親子追従（openerTabIdなど）
  - 親なしタブのフォールバックグループ
  - 優先度/競合解決（priority: number, default 0）
  - 変数展開（例: ${env}）
  - ユニットテスト（TDD）
- [ ] Out of scope:
  - 自動適用モード
  - 自動整理（TTL/上限）
  - Options UIの高度機能
  - 診断API/CLI/E2E
- [ ] Assumptions:
  - 変数はYAML内のvarsや環境値に限定
  - 親子判定はChromeが提供する関係のみ
  - 評価順: 親子追従 → パターン → フォールバック
  - パターン同士の競合は priority 降順、同順位はYAML定義順で決定
- [ ] Risks:
  - 競合解決の仕様が不明確だと運用で混乱する

# Acceptance Criteria

- [ ] AC1: 親タブがグループ所属の場合、子タブは同じグループに入る。
- [ ] AC2: 親なしタブでマッチがない場合、フォールバックグループに入る。
- [ ] AC3: 優先度/競合解決が決定的で、テストで検証されている。
- [ ] AC4: 変数展開が正しく行われ、無効な参照はエラーとなる。
- [ ] AC5: ユニットテスト（TDD）が追加されている。

# Notes

- 競合解決は「priority降順→YAML定義順」を固定ルールとする。
